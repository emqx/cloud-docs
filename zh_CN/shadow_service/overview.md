# 影子服务

## 什么是影子服务

影子服务是由 EMQX Cloud 提供的一个**设备数据缓存**服务，用户可以通过 Topic 以及 API 定义和使用，快速实现物联网应用。


有了影子服务，用户不必自己购买云服务、创建 VPC 连接再创建应用。而是基于此能力快速实现如物模型、设备影子以及其他和数据上报及下发相关的应用，极大节省开发时间和成本。

![Benefit](./_assets/benefit.png)

## 服务开通

鉴于影子服务用到的阿里云云计算资源的原因，目前只针对于部署在阿里云的 MQTT 部署可以使用。由于地域限制，如果您的部署在**阿里云张家口**地区，也无法开通本服务。另外影子服务**只对于专业版开放**，如果您购买的是基础版，暂时无法使用本服务。

### 开通方式一
如果您的部署符合以上条件，并且处于运行状态，进入部署控制台，点击左侧菜单的`影子服务`，再次点击`开通服务`即可进入服务开通流程。

![entry](./_assets/entry01.png)

### 开通方式二
点击顶部菜单`增值服务`，点击影子服务卡片上的`开通服务`，进入服务开通页面。如果当前您有正在运行中的阿里云的专业版部署，则可以在下拉选项中找到符合条件的部署，从而可以继续开通流程。

![entry](./_assets/entry02.png)

### 开通说明
影子服务的指标包括存储空间、调用次数、出网流量。

1. 影子服务供提供3种规格：1G，2G，4G。这四种规格标明了存储空间的大小，决定了影子模型数量的上限。目前系统控制的单个影子模型**最大为 128KB**，按此文件大小，并扣除预留的存储空间，不同规格可以创建的影子模型的**预估数量**为：

<table>
   <tr>
      <th>规格</th>
      <th>影子模型数量</th>
   </tr>
   <tr>
      <td>1 G</td>
      <td>7000</td>
   </tr>
   <tr>
      <td>2 G</td>
      <td>14000</td>
   </tr>
   <tr>
      <td>4 G</td>
      <td>28000</td>
   </tr>
</table>

**以上数字仅供参考，真实可创建的影子模型数量以实际为准。由于影子模型大小一般小于最大值 128KB，实际可创建的数量的上限可远多于以上数字。**


2. 影子服务的调用次数包含了设备和客户端对 Topic 每次的消息发布，以及对 API 的每一次调用。将按照 **0.03 元/万次**的单价进行计费。

3. 服务产生的出网流量的将计算在所在部署的每月流量中。

4. 服务最高支持 200 QPS（Query Per Second）

### 服务试用

影子服务提供7天的试用，试用规则如下：

1. 只有专业版部署才能试用影子服务
2. 试用只能选择 1G 规格的服务
3. 一个账号只有一次试用机会，当试用期结束或者试用期中删除服务都不能再次试用
3. 试用结束后，服务将按照使用情况进行计费
4. 试用结束后，如果当前账户没有余额进行扣费，服务将被删除，影子服务相关数据同时也被删除

## 服务计费

计费详细规则请查看 [服务费用](./pricing.md)。


## 删除服务

请注意，当服务进入计费阶段，**即使没有创建任何影子模型，服务仍然会进行计费**。当您确定不再使用，而需删除服务，请点击顶部菜单`增值服务` - 点击影子服务卡片上的`服务详情`，在影子服务列表中删除对应服务才能完全删除服务并停止计费。

![delete](./_assets/deletion.png)

## 快速入门

请查看 [功能概览](./feature.md) 快速了解服务功能使用。

## 场景案例

了解如何使用影子服务快速实现 [设备影子物联网应用 Demo](./device_shadow.md)。


了解如何使用影子服务快速实现 [物模型应用 Demo](./things_model.md)。
